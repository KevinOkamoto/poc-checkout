<ui5-page id="page" background-design="List" floating-footer show-footer>
  <div slot="header">
    <ui5-bar design="Header">
      <ui5-label slot="middleContent">Checkout Page</ui5-label>
      <ui5-button design="Default" slot="endContent">Submit</ui5-button>
      <ui5-button design="Emphasized" slot="endContent">Edit</ui5-button>
    </ui5-bar>
  </div>
  <div class="header-form">
    <section class="form-column">

      <ng-container *ngTemplateOutlet="input; context: {$implicit: requisition, field:'title', title: 'Title'}">
      </ng-container>

      <ng-container *ngTemplateOutlet="combobox; context: {$implicit: requisition, field:'shippingAddress',
      title: 'Shipping Address', dataSource: addressDB }">
      </ng-container>


      <ng-container *ngTemplateOutlet="combobox; context: {$implicit: requisition, field:'billingAddress',
      title: 'Billing Addresss', dataSource: addressDB }">
      </ng-container>

      <ng-container *ngTemplateOutlet="combobox; context: {$implicit: requisition, field:'supplier',
      title: 'Supplier', dataSource: supplierDB }">
      </ng-container>


      <ng-container *ngTemplateOutlet="date; context: {$implicit: requisition, field:'dueOn', title: 'Due On'}">
      </ng-container>
    </section>
    <section class="form-column ">
      <ng-container *ngTemplateOutlet="select; context: {$implicit: requisition, field:'currency', title: 'Currency',
      dataSource: ['USD', 'CZK', 'EUR']}">
      </ng-container>


      <ng-container *ngTemplateOutlet="combobox; context: {$implicit: requisition, field:'requester',
      title: 'Requester', dataSource: userDB  }">
      </ng-container>


      <ng-container *ngTemplateOutlet="combobox; context: {$implicit: requisition, field:'commodityCode',
      title: 'Commodity Code', dataSource: commodityCodeDB  }">
      </ng-container>
    </section>

  </div>

  <ng-container *ngTemplateOutlet="table; context: {$implicit: requisition, field:'lineItems',
      title: 'Line Items', dataSource: lineItems$  }">
  </ng-container>


  <div slot="footer">
    <ui5-bar design="FloatingFooter">
      <ui5-button design="Positive" slot="endContent">Agree</ui5-button>
      <ui5-button design="Negative" slot="endContent">Decline</ui5-button>
      <ui5-button design="Transparent" slot="endContent">Cancel</ui5-button>
    </ui5-bar>
  </div>
</ui5-page>


<ng-template #input let-entity let-field="field" let-title="title">
  <ui5-label [for]="field" required>{{title}}:</ui5-label>
  <ui5-input #input
             [id]="field"
             [value]="entity[field]"
             (input)="entity[field]  = input.value"></ui5-input>

</ng-template>


<ng-template #select let-entity let-field="field" let-title="title" let-ds="dataSource">
  <ui5-label [for]="field" required>{{title}}:</ui5-label>
  <ui5-select #select class="select" [value]="entity[field]" [id]="field"
              (change)="entity[field]  = select.selectedOption.innerText">
    <ui5-option *ngFor="let item of ds" [selected]="item === entity[field]">{{item}}</ui5-option>
  </ui5-select>


</ng-template>


<ng-template #date let-entity let-field="field" let-title="title">
  <ui5-label [for]="field">{{title}}:</ui5-label>
  <ui5-date-picker #date [id]="field" format-pattern="dd/MM/yyyy"
                   [value]="entity[field] | date:'dd/MM/yyyy'"
                   (change)="entity[field]  = date.dateValue"
  ></ui5-date-picker>

</ng-template>


<ng-template #combobox let-entity let-field="field" let-title="title" let-ds="dataSource">
  <ng-template [ngIf]="ds && ds.length > 0">
    <ui5-label [for]="field" required>{{title}}:</ui5-label>
    <ui5-combobox #combo [id]="field" filter="Contains"
                  [value]="entity[field]?.name"
                  (change)="onCBSelection(field, combo.value)">
      <ui5-cb-item *ngFor="let item of ds" [text]="item.name"></ui5-cb-item>
    </ui5-combobox>
  </ng-template>
</ng-template>


<ng-template #table let-entity let-field="field" let-title="title" let-ds="dataSource">

  <div class="table-wrapper">
    <ui5-label for="lineItems" required>{{title}}:</ui5-label>
    <div class="header">
      <ui5-input id="searchInput" placeholder="Enter search criteria ..." style="width: 120px">
        <ui5-icon id="searchIcon" slot="icon" name="search"></ui5-icon>
      </ui5-input>
    </div>

    <ui5-table class="demo-table" id="table" no-data-text="No Data">
      <ui5-table-column slot="columns" style="width: 12rem">
        <span style="line-height: 1.4rem">Line #:</span>
      </ui5-table-column>

      <ui5-table-column slot="columns" min-width="800" popin-text="Supplier">
        <span style="line-height: 1.4rem">Name:</span>
      </ui5-table-column>

      <ui5-table-column slot="columns" min-width="600" popin-text="Dimensions" demand-popin>
        <span style="line-height: 1.4rem">Supplier:</span>
      </ui5-table-column>

      <ui5-table-column slot="columns" min-width="600" popin-text="Weight" demand-popin>
        <span style="line-height: 1.4rem">Unit Price:</span>
      </ui5-table-column>
      e
      <ui5-table-column slot="columns">
        <span style="line-height: 1.4rem">Quantity:</span>
      </ui5-table-column>

      <ui5-table-column slot="columns">
        <span style="line-height: 1.4rem">Net Amount:</span>
      </ui5-table-column>


      <ui5-table-row *ngFor="let item of ds | async">
        <ui5-table-column slot="columns" style="width: 12rem">
          <span style="line-height: 1.4rem">{{item.id}}</span>
        </ui5-table-column>

        <ui5-table-column slot="columns" min-width="800" popin-text="Supplier">
          <span style="line-height: 1.4rem">{{item.name}}</span>
        </ui5-table-column>

        <ui5-table-column slot="columns" min-width="600" popin-text="Dimensions" demand-popin>
          <span style="line-height: 1.4rem">{{item.supplier}}</span>
        </ui5-table-column>

        <ui5-table-column slot="columns" min-width="600" popin-text="Weight" demand-popin>
          <span style="line-height: 1.4rem">{{item.unitPrice}}</span>
        </ui5-table-column>

        <ui5-table-column slot="columns">
          <span style="line-height: 1.4rem">{{item.quantity}}</span>
        </ui5-table-column>

        <ui5-table-column slot="columns">
          <span style="line-height: 1.4rem">{{item.totalPrice}}</span>
        </ui5-table-column>
      </ui5-table-row>
    </ui5-table>
  </div>

</ng-template>
